{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}

{% block content %}
    <!-- Portfolio Details Section -->
    <section id="portfolio-details" class="portfolio-details section">
      <div class="container" data-aos="fade-up" data-aos-delay="100">
        <div class="row gy-4">
          <div class="col-lg-6" data-aos="fade-right">
            <div class="portfolio-details-media">
              {% if page.gallery_images.all %}
              <div class="main-image">
                <div class="portfolio-details-slider swiper init-swiper" data-aos="zoom-in">
                  <!-- Swiper Config (can remain static) -->
              <script type="application/json" class="swiper-config">
                {
                  "loop": true,
                  "speed": 1000,
                  "autoplay": {
                    "delay": 6000
                  },
                  "effect": "creative",
                  "creativeEffect": {
                    "prev": {
                      "shadow": true,
                      "translate": [0, 0, -400]
                    },
                    "next": {
                      "translate": ["100%", 0, 0]
                    }
                  },
                  "slidesPerView": 1,
                  "navigation": {
                    "nextEl": ".swiper-button-next",
                    "prevEl": ".swiper-button-prev"
                  }
                }
              </script>

                  <div class="swiper-wrapper">
                    {% for item in page.gallery_images.all %}
                    <div class="swiper-slide">
                      {% if item.image %}
                      {% image item.image fill-800x600 as img %}
                      <img src="{{ img.url }}" alt="{{ img.alt }}" class="img-fluid">
                      {% elif item.image_url %}
                      <img src="{{ item.image_url }}" class="img-fluid">
                      {% else %}
                      {% endif %}
                    </div>
                    {% endfor %}
                  </div>
                  <div class="swiper-button-prev"></div>
                  <div class="swiper-button-next"></div>
                </div>
              </div>
              {% endif %}

          <div class="thumbnail-grid" data-aos="fade-up" data-aos-delay="200">
            <div class="row g-2 mt-3">
                {% for item in page.gallery_images.all %}
                    <div class="col-3">
                      {% if item.image %}
                        {% image item.image fill-165x165 as thumb %}
                        <img
                        src="{{ thumb.url }}"
                        alt="{{ item.caption|default:page.title }}"
                        class="img-fluid glightbox"
                        />
                      {% elif item.image_url %}
                        <img
                        src="{{ item.image_url }}"
                        alt="{{ item.caption|default:page.title }}"
                        class="img-fluid glightbox"
                        />
                      {% else %}
                      {% endif %}
                    </div>
                {% endfor %}
            </div>
          </div>
              

              {% if page.tech_stack.all %}
              <div class="tech-stack-badges" data-aos="fade-up" data-aos-delay="300">
                {% for badge in page.tech_stack.all %}
                  <span>{{ badge.name }}</span>
                {% endfor %}
              </div>
              {% endif %}
            </div>
          </div>

          <div class="col-lg-6" data-aos="fade-left">
            <div class="portfolio-details-content">
              <div class="project-meta">
                {% if page.category %}
                <div class="badge-wrapper">
                  <span class="project-badge">{{ page.category.name }}</span>
                </div>
                {% endif %}
                <div class="date-client">
                  {% if page.project_date %}
                  <div class="meta-item"><i class="bi bi-calendar-check"></i><span>{{ page.project_date|date:"F Y" }}</span></div>
                  {% endif %}
                  {% if page.client_name %}
                  <div class="meta-item"><i class="bi bi-buildings"></i><span>{{ page.client_name }}</span></div>
                  {% endif %}
                </div>
              </div>

              <h2 class="project-title">{{ page.title }}</h2>

              {% if page.project_website %}
              <div class="project-website">
                <i class="bi bi-link-45deg"></i>
                <a href="{{ page.project_website }}" target="_blank">{{ page.project_website }}</a>
              </div>
              {% endif %}
              
              <div class="project-overview">
                <p class="lead">{{ page.lead_paragraph }}</p>
                
                {# Render the StreamField body #}
                {% for block in page.body %}
                    {% include_block block %}
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    {# Include the pricing section template #}
    {% include "products/includes/pricing.html" with page=page %}
{% endblock %}